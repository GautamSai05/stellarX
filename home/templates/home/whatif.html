{% extends 'base.html' %}
{% load static %}

{% block title %}What If Simulator - StellarSense{% endblock %}

{% block content %}
<main class="container mx-auto p-4 min-h-screen" aria-labelledby="pageTitle">
  <div class="mb-8">
    <h2 id="pageTitle" class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-2">What If Space Simulator</h2>
    <p class="text-gray-400">Explore alternate histories and see how different choices could have shaped space exploration.</p>
  </div>

  <div id="simulatorRoot"></div>
</main>

<script>
// Scenario data converted from the provided component
const scenarios = [
  {
    id: 'mars-80s',
    title: 'What if Mars missions started in the 1980s?',
    description: 'Explore an alternate timeline where humanity reached Mars during the Cold War era.',
    timeline: [
      { year: '1981', event: 'Mars Mission Announcement', description: 'President Reagan announces the Mars Initiative as a response to Soviet space achievements.' },
      { year: '1985', event: 'First Mars Probe Success', description: 'Advanced robotic missions successfully map Mars and identify landing sites.' },
      { year: '1989', event: 'First Human Mars Landing', description: 'A joint US-Soviet crew lands on Mars, marking the beginning of human interplanetary exploration.' },
      { year: '1995', event: 'Permanent Mars Base', description: 'The first permanent research station is established on Mars with rotating crews.' },
      { year: '2000', event: 'Mars Terraforming Begins', description: 'Large-scale atmospheric modification projects begin to make Mars more Earth-like.' }
    ],
    consequences: [
      'Advanced propulsion technology developed 30 years earlier',
      'International space cooperation accelerated',
      'Climate change solutions discovered through terraforming research',
      'Asteroid mining industry established by 2000',
      'Human population on Mars reaches 10,000 by 2024'
    ],
    probability: 'Medium',
    impact: 'Revolutionary'
  },
  {
    id: 'no-apollo',
    title: 'What if the Apollo program never happened?',
    description: 'Imagine a world where the Moon landing was never achieved and space exploration took a different path.',
    timeline: [
      { year: '1969', event: 'Continued Earth Orbit Focus', description: 'NASA focuses on building larger space stations instead of lunar missions.' },
      { year: '1975', event: 'International Space City', description: 'A massive international space station houses 100+ astronauts permanently.' },
      { year: '1985', event: 'Space Manufacturing', description: 'Zero-gravity manufacturing becomes commercially viable, revolutionizing industry.' },
      { year: '1995', event: 'First Moon Landing', description: 'Commercial companies finally achieve the first Moon landing for mining purposes.' },
      { year: '2010', event: 'Lunar Industrial Complex', description: 'The Moon becomes a major industrial hub with thousands of workers.' }
    ],
    consequences: [
      'Space technology develops more gradually but sustainably',
      'Commercial space industry emerges 20 years earlier',
      'International cooperation becomes the norm in space',
      'Earth-orbit infrastructure far more advanced',
      'Moon colonization driven by economics, not exploration'
    ],
    probability: 'High',
    impact: 'Significant'
  },
  {
    id: 'alien-contact',
    title: 'What if we received an alien signal in 1977?',
    description: 'Explore how first contact with extraterrestrial intelligence would have changed human civilization.',
    timeline: [
      { year: '1977', event: 'The Signal Received', description: 'SETI detects an unmistakable artificial signal from Proxima Centauri.' },
      { year: '1980', event: 'Global Space Alliance', description: 'All nations unite to form a single space agency to respond to the signal.' },
      { year: '1990', event: 'Advanced Propulsion', description: 'Breakthrough in physics leads to development of near-light-speed travel.' },
      { year: '2000', event: 'First Interstellar Probe', description: 'Humanity launches its first probe toward the alien civilization.' },
      { year: '2024', event: 'Ongoing Communication', description: 'Regular communication established, sharing knowledge and culture.' }
    ],
    consequences: [
      'End of international conflicts as humanity unites',
      'Massive acceleration in scientific advancement',
      'New philosophical and religious movements emerge',
      'Interstellar travel technology developed',
      'Human civilization becomes part of galactic community'
    ],
    probability: 'Low',
    impact: 'Transformative'
  },
  {
    id: 'space-elevator',
    title: 'What if space elevators were built in 2000?',
    description: 'See how cheap access to space would have revolutionized human civilization.',
    timeline: [
      { year: '2000', event: 'First Space Elevator', description: 'Revolutionary carbon nanotube technology enables the first space elevator.' },
      { year: '2005', event: 'Space Tourism Boom', description: 'Space travel becomes as common as international flights.' },
      { year: '2010', event: 'Orbital Cities', description: 'Massive space habitats house millions of people in Earth orbit.' },
      { year: '2015', event: 'Solar Power Satellites', description: "Space-based solar power solves Earth's energy crisis completely." },
      { year: '2020', event: 'Interplanetary Highway', description: 'Regular cargo and passenger service to Mars, Moon, and asteroid belt.' }
    ],
    consequences: [
      "Climate change solved through space-based solar power",
      "Earth's population pressure relieved by space colonies",
      "Asteroid mining makes rare materials abundant",
      "Scientific research accelerated by easy space access",
      "New space-born human cultures develop"
    ],
    probability: 'Medium',
    impact: 'Revolutionary'
  }
];

// Utilities
function getProbabilityColor(prob) {
  if (prob === 'High') return 'text-green-400 bg-green-600/20';
  if (prob === 'Medium') return 'text-yellow-400 bg-yellow-600/20';
  if (prob === 'Low') return 'text-red-400 bg-red-600/20';
  return 'text-gray-400 bg-gray-600/20';
}
function getImpactColor(impact) {
  if (impact === 'Transformative') return 'text-purple-400 bg-purple-600/20';
  if (impact === 'Revolutionary') return 'text-blue-400 bg-blue-600/20';
  if (impact === 'Significant') return 'text-orange-400 bg-orange-600/20';
  return 'text-gray-400 bg-gray-600/20';
}

// Render UI
const root = document.getElementById('simulatorRoot');
let selectedScenario = null;
let isSimulating = false;
let currentEventIndex = 0;
let simInterval = null;

function renderScenarioList() {
  root.innerHTML = '';
  const grid = document.createElement('div');
  grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-6';

  scenarios.forEach(scenario => {
    const card = document.createElement('div');
    card.className = 'bg-gray-900/60 backdrop-blur-md rounded-2xl p-6 border border-white/10 cursor-pointer hover:border-blue-500/50 transition-all';

    const inner = document.createElement('div');
    inner.className = 'flex items-start space-x-4 mb-4';
    const iconWrap = document.createElement('div');
    iconWrap.className = 'p-3 bg-blue-600/20 rounded-xl';
    iconWrap.innerHTML = '<svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l3 7-6 4 8 8-10-6-2 6"></path></svg>';
    const meta = document.createElement('div');
    meta.className = 'flex-1';
    const title = document.createElement('h3');
    title.className = 'text-xl font-semibold text-white mb-2';
    title.textContent = scenario.title;
    const desc = document.createElement('p');
    desc.className = 'text-gray-400 text-sm';
    desc.textContent = scenario.description;
    meta.appendChild(title);
    meta.appendChild(desc);
    inner.appendChild(iconWrap);
    inner.appendChild(meta);

    const badges = document.createElement('div');
    badges.className = 'flex items-center justify-between mb-4';
    badges.innerHTML = `
      <div class="flex space-x-2">
        <span class="px-3 py-1 rounded-full text-sm ${getProbabilityColor(scenario.probability)}">${scenario.probability} Probability</span>
        <span class="px-3 py-1 rounded-full text-sm ${getImpactColor(scenario.impact)}">${scenario.impact} Impact</span>
      </div>
    `;

    const runBtn = document.createElement('button');
    runBtn.className = 'w-full flex items-center justify-center space-x-2 py-3 bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 rounded-lg transition-colors';
    runBtn.innerHTML = '<span>Run Simulation</span>';
    runBtn.addEventListener('click', () => startSimulation(scenario));

    card.appendChild(inner);
    card.appendChild(badges);
    card.appendChild(runBtn);

    grid.appendChild(card);
  });

  root.appendChild(grid);
}

function renderSimulationView() {
  root.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'max-w-4xl mx-auto';

  const header = document.createElement('div');
  header.className = 'flex items-center justify-between mb-8';
  header.innerHTML = `
    <div>
      <h3 class="text-2xl font-bold text-white mb-2">${selectedScenario.title}</h3>
      <p class="text-gray-400">${selectedScenario.description}</p>
    </div>
  `;
  const resetBtn = document.createElement('button');
  resetBtn.className = 'flex items-center space-x-2 px-4 py-2 bg-gray-600/20 hover:bg-gray-600/30 rounded-lg transition-colors';
  resetBtn.textContent = 'Reset';
  resetBtn.addEventListener('click', resetSimulation);
  header.appendChild(resetBtn);

  wrap.appendChild(header);

  // Timeline container
  const timelineCard = document.createElement('div');
  timelineCard.className = 'bg-gray-900/60 backdrop-blur-md rounded-2xl p-8 border border-white/10 mb-8';
  timelineCard.innerHTML = '<h4 class="text-xl font-semibold text-white mb-6">Alternate Timeline</h4>';

  const eventsWrap = document.createElement('div');
  eventsWrap.className = 'space-y-6';

  selectedScenario.timeline.forEach((ev, idx) => {
    const evDiv = document.createElement('div');
    evDiv.className = 'flex items-start space-x-4 p-4 rounded-xl transition-all';
    evDiv.dataset.index = idx;

    const badge = document.createElement('div');
    badge.className = 'w-12 h-12 rounded-full flex items-center justify-center font-bold bg-gray-600/30 text-gray-400';
    badge.textContent = ev.year.slice(-2);
    const info = document.createElement('div');
    info.className = 'flex-1';
    info.innerHTML = `<div class="flex items-center space-x-3 mb-2"><h5 class="font-semibold text-gray-400">${ev.event}</h5><span class="text-sm px-2 py-1 rounded-full bg-gray-600/20 text-gray-400">${ev.year}</span></div><p class="text-sm text-gray-500">${ev.description}</p>`;
    evDiv.appendChild(badge);
    evDiv.appendChild(info);
    eventsWrap.appendChild(evDiv);
  });

  timelineCard.appendChild(eventsWrap);
  wrap.appendChild(timelineCard);

  // Consequences / Analysis
  const grid = document.createElement('div');
  grid.className = 'grid grid-cols-1 lg:grid-cols-2 gap-8';

  const consequencesCard = document.createElement('div');
  consequencesCard.className = 'bg-gray-900/60 backdrop-blur-md rounded-2xl p-6 border border-white/10';
  consequencesCard.innerHTML = '<h4 class="text-xl font-semibold text-white mb-4">Major Consequences</h4>';
  const consequencesList = document.createElement('div');
  consequencesList.className = 'space-y-3';
  selectedScenario.consequences.forEach(c => {
    const item = document.createElement('div');
    item.className = 'flex items-start space-x-3 p-3 bg-white/5 rounded-lg';
    item.innerHTML = `<div class="w-6 h-6 bg-green-600/20 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><div class="w-2 h-2 bg-green-400 rounded-full"></div></div><span class="text-gray-300 text-sm">${c}</span>`;
    consequencesList.appendChild(item);
  });
  consequencesCard.appendChild(consequencesList);

  const analysisCard = document.createElement('div');
  analysisCard.className = 'bg-gray-900/60 backdrop-blur-md rounded-2xl p-6 border border-white/10';
  analysisCard.innerHTML = '<h4 class="text-xl font-semibold text-white mb-4">Scenario Analysis</h4>';
  analysisCard.innerHTML += `
    <div class="space-y-4">
      <div>
        <div class="flex items-center justify-between mb-2"><span class="text-gray-400">Probability</span><span class="px-3 py-1 rounded-full text-sm ${getProbabilityColor(selectedScenario.probability)}">${selectedScenario.probability}</span></div>
        <div class="w-full bg-gray-700 rounded-full h-2"><div class="h-2 rounded-full ${selectedScenario.probability === 'High' ? 'bg-green-500 w-4/5' : selectedScenario.probability === 'Medium' ? 'bg-yellow-500 w-3/5' : 'bg-red-500 w-2/5'}"></div></div>
      </div>
      <div>
        <div class="flex items-center justify-between mb-2"><span class="text-gray-400">Impact Level</span><span class="px-3 py-1 rounded-full text-sm ${getImpactColor(selectedScenario.impact)}">${selectedScenario.impact}</span></div>
        <div class="w-full bg-gray-700 rounded-full h-2"><div class="h-2 rounded-full ${selectedScenario.impact === 'Transformative' ? 'bg-purple-500 w-full' : selectedScenario.impact === 'Revolutionary' ? 'bg-blue-500 w-4/5' : 'bg-orange-500 w-3/5'}"></div></div>
      </div>
      <div class="pt-4 border-t border-white/10">
        <h5 class="font-semibold text-white mb-2">Key Factors</h5>
        <div class="text-sm text-gray-400 space-y-1"><div>• Political will and international cooperation</div><div>• Technological breakthroughs and timing</div><div>• Economic conditions and funding</div><div>• Public support and cultural factors</div></div>
      </div>
    </div>
  `;

  grid.appendChild(consequencesCard);
  grid.appendChild(analysisCard);
  wrap.appendChild(grid);

  root.appendChild(wrap);

  // highlight function to update timeline visual state
  function highlight(index) {
    const items = eventsWrap.querySelectorAll('[data-index]');
    items.forEach(it => {
      const i = Number(it.dataset.index);
      const badge = it.querySelector('.w-12');
      if (i <= index) {
        it.classList.add('bg-blue-600/20');
        it.classList.add('border');
        it.classList.add('border-blue-500/30');
        it.querySelector('h5').classList.remove('text-gray-400');
        it.querySelector('h5').classList.add('text-white');
        it.querySelector('p').classList.remove('text-gray-500');
        it.querySelector('p').classList.add('text-gray-300');
        badge.classList.remove('bg-gray-600/30');
        badge.classList.remove('text-gray-400');
        badge.classList.add('bg-blue-600/30');
        badge.classList.add('text-blue-300');
      } else {
        it.classList.remove('bg-blue-600/20');
        it.classList.remove('border');
        it.classList.remove('border-blue-500/30');
        it.querySelector('h5').classList.remove('text-white');
        it.querySelector('h5').classList.add('text-gray-400');
        it.querySelector('p').classList.remove('text-gray-300');
        it.querySelector('p').classList.add('text-gray-500');
        badge.classList.remove('bg-blue-600/30');
        badge.classList.remove('text-blue-300');
        badge.classList.add('bg-gray-600/30');
        badge.classList.add('text-gray-400');
      }
    });
  }

  // initial highlight
  highlight(currentEventIndex);
}

function startSimulation(scenario) {
  selectedScenario = scenario;
  isSimulating = true;
  currentEventIndex = 0;
  renderSimulationView();

  simInterval = setInterval(() => {
    currentEventIndex = Math.min(currentEventIndex + 1, selectedScenario.timeline.length - 1);
    // update highlight
    const items = document.querySelectorAll('#simulatorRoot [data-index]');
    items.forEach(it => {
      const idx = Number(it.dataset.index);
      if (idx <= currentEventIndex) {
        it.classList.add('bg-blue-600/20');
        it.classList.add('border');
        it.classList.add('border-blue-500/30');
      }
    });

    if (currentEventIndex >= selectedScenario.timeline.length - 1) {
      clearInterval(simInterval);
      isSimulating = false;
    }
  }, 2000);
}

function resetSimulation() {
  selectedScenario = null;
  isSimulating = false;
  currentEventIndex = 0;
  if (simInterval) clearInterval(simInterval);
  renderScenarioList();
}

// init
renderScenarioList();

</script>

{% endblock %}
