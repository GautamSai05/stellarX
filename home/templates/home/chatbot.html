<!-- Only the body of the chatbot, no <html>, <head>, or <body> tags -->

<!-- Chat Bot Icon (Rocket) -->
<button id="chat-bot-icon" aria-label="Open Space Chat">
    <svg class="rocket-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C13.1 2 14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C15.1 7 16 7.9 16 9V10C16 10.55 16.45 11 17 11S18 10.55 18 10V9C18 6.79 16.21 5 14 5H13V4C13 2.9 12.1 2 11 2H12ZM12 8C10.9 8 10 8.9 10 10V14L8 16V18H10V20C10 21.1 10.9 22 12 22S14 21.1 14 20V18H16V16L14 14V10C14 8.9 13.1 8 12 8Z"/>
    </svg>
</button>

<!-- Chat Container -->
<div id="chat-container">
    <div class="chat-header">
        <div class="chat-title">
            ðŸš€ Space Command
            <div class="status-indicator"></div>
        </div>
        <button id="chat-toggle">Ã—</button>
    </div>
    <div id="chat-body">
        <div id="live-comments"></div>
        <form id="chat-form">
            <input type="text" id="chat-message-input" placeholder="Ask about your publications, projects, awards..." autocomplete="off">
            <button type="submit" class="send-button">ðŸš€ Send</button>
        </form>
    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    #chat-bot-icon {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 50;
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: hidden;
    }
    #chat-bot-icon:hover {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
    }
    .rocket-icon {
        width: 40px;
        height: 40px;
        color: white;
        z-index: 2;
        position: relative;
    }
    #chat-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 400px;
        max-width: calc(100vw - 40px);
        height: 600px;
        max-height: 80vh;
        background: linear-gradient(135deg, #1E1B4B 0%, #312E81 15%, #3730A3 30%, #4338CA 45%, #3730A3 60%, #312E81 75%, #1E1B4B 90%, #0F0C29 100%);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(139, 92, 246, 0.2);
        border-radius: 1.5rem;
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 50;
        padding: 0;
    }
    .chat-header {
        background: linear-gradient(135deg, #6B46C1 0%, #7C3AED 25%, #8B5CF6 50%, #7C3AED 75%, #6B46C1 100%);
        color: #f3e8ff;
        border-radius: 1.25rem 1.25rem 0 0;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 2px 4px rgba(139, 92, 246, 0.3);
        padding: 1.25rem 1.5rem;
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .chat-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .status-indicator {
        width: 8px;
        height: 8px;
        background: #10B981;
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.7; }
    }
    #chat-toggle {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.5rem;
        cursor: pointer;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s, transform 0.3s;
    }
    #chat-toggle:hover {
        background: rgba(255,255,255,0.1);
        transform: rotate(90deg);
    }
    #chat-body {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        min-height: 0;
        padding: 1rem 1.5rem 0.5rem 1.5rem;
        background: transparent;
    }
    #live-comments {
        flex: 1 1 auto;
        min-height: 0;
        max-height: 100%;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        color: #f3e8ff;
        margin-bottom: 0.75rem;
        font-size: 1rem;
        padding-right: 8px;
    }
    #live-comments::-webkit-scrollbar {
        width: 6px;
    }
    #live-comments::-webkit-scrollbar-thumb {
        background: #7C3AED;
        border-radius: 3px;
    }
    .message {
        background: linear-gradient(135deg, #3730A3 0%, #4338CA 50%, #5B21B6 100%);
        color: #f3e8ff;
        border: none;
        border-radius: 1.25rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3), inset 0 1px 0 rgba(139,92,246,0.2);
        padding: 1rem 1.25rem;
        max-width: 80%;
        margin-bottom: 0.25rem;
        word-break: break-word;
        font-size: 1rem;
        font-weight: 500;
        transition: background 0.3s;
    }
    .message.user {
        background: linear-gradient(135deg, #6B46C1 0%, #7C3AED 50%, #8B5CF6 100%);
        color: #fff;
        margin-left: auto;
        border-radius: 1.25rem 1.25rem 0.25rem 1.25rem;
    }
    .message.bot {
        background: linear-gradient(135deg, #3730A3 0%, #4338CA 50%, #5B21B6 100%);
        color: #e0e7ff;
        margin-right: auto;
        border-radius: 1.25rem 1.25rem 1.25rem 0.25rem;
    }
    #chat-form {
        background: linear-gradient(135deg, #312E81 0%, #3730A3 50%, #4338CA 100%);
        border: none;
        box-shadow: 0 2px 4px rgba(139,92,246,0.2), inset 0 2px 4px rgba(0,0,0,0.3);
        border-radius: 0 0 1.25rem 1.25rem;
        display: flex;
        align-items: center;
        padding: 1rem 0;
        margin: 0;
        gap: 0.75rem;
    }
    #chat-message-input {
        flex: 1 1 auto;
        min-height: 48px;
        max-height: 80px;
        font-size: 1.1rem;
        color: #f3e8ff;
        background: transparent;
        border: none;
        outline: none;
        padding: 0.75rem 1rem;
        border-bottom: 2px solid #7C3AED;
        font-weight: 500;
        transition: border-color 0.3s;
    }
    #chat-message-input:focus {
        border-bottom: 2px solid #A855F7;
    }
    #chat-message-input::placeholder {
        color: #a78bfa;
        opacity: 1;
    }
    .send-button {
        background: linear-gradient(135deg, #059669 0%, #10B981 50%, #34D399 100%);
        color: #fff;
        border: none;
        border-radius: 9999px;
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 1px 0 rgba(52,211,153,0.3);
        margin-left: 0.75rem;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
    }
    .send-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .send-button:hover:not(:disabled) {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        transform: scale(1.08);
    }
    @media (max-width: 600px) {
        #chat-container {
            width: 98vw !important;
            min-width: 0 !important;
            max-width: 100vw !important;
            left: 1vw !important;
            right: 1vw !important;
            bottom: 1vw !important;
            border-radius: 1rem !important;
        }
        #chat-body, #live-comments {
            font-size: 0.95rem;
        }
    }
</style>

<script>
    // Show chat on icon click, hide icon
    const chatBotIcon = document.getElementById('chat-bot-icon');
    const chatContainer = document.getElementById('chat-container');
    const chatToggle = document.getElementById('chat-toggle');
    const chatBody = document.getElementById('chat-body');
    const commentBox = document.getElementById('live-comments');
    const chatInput = document.getElementById('chat-message-input');
    const chatForm = document.getElementById('chat-form');

    chatBotIcon.addEventListener('click', () => {
        chatBotIcon.classList.add('rocket-launching');
        setTimeout(() => {
            chatBotIcon.style.display = 'none';
            chatContainer.style.display = 'flex';
            chatContainer.classList.add('chat-show');
            chatInput.focus();
        }, 400);
    });

    chatToggle.addEventListener('click', () => {
        chatContainer.classList.remove('chat-show');
        chatContainer.classList.add('chat-hide');
        setTimeout(() => {
            chatContainer.style.display = 'none';
            chatContainer.classList.remove('chat-hide');
            chatBotIcon.style.display = 'flex';
            chatBotIcon.classList.remove('rocket-launching');
        }, 400);
    });

    // WebSocket logic (unchanged)
    const wsScheme = window.location.protocol === "https:" ? "wss" : "ws";
    const socket = new WebSocket(wsScheme + '://' + window.location.host + '/ws/comments/');

    socket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        if (data.message && data.username) {
            const comment = document.createElement('div');
            comment.className = 'message';
            comment.innerHTML = `<span class="username">${data.username}</span>: ${data.message}`;
            commentBox.appendChild(comment);
            commentBox.scrollTop = commentBox.scrollHeight;
        }
    };

    chatForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (message) {
            socket.send(JSON.stringify({ message: message }));
            chatInput.value = '';
        }
    });
</script>